"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9702],{4211:(e,t,r)=>{r.d(t,{$:()=>l,r:()=>o});var a=r(20906),s=r(90882),i=r(57742),n=r(33826),u=r(66208);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),l=n.forwardRef((e,t)=>{let{className:r,variant:i,size:n,asChild:l=!1,...c}=e,d=l?s.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,u.cn)(o({variant:i,size:n,className:r})),ref:t,...c})});l.displayName="Button"},24830:(e,t,r)=>{r.d(t,{$v:()=>i,n0:()=>s});var a=r(39236);let s={monitoring:{enabled:!!a.env.FEATURE_FLAG_MONITORING_ENABLED,endpoint:a.env.FEATURE_FLAG_MONITORING_ENDPOINT,apiKey:a.env.FEATURE_FLAG_MONITORING_API_KEY},caching:{enabled:!0,ttl:parseInt(a.env.FEATURE_FLAG_CACHE_TTL||"300000")},analytics:{enabled:!0,trackUsage:!0,trackPerformance:!0}},i={NOTIFICATION_SYSTEM_FEATURE:"notification_system_feature",CALENDAR_FEATURE:"calendar_feature",PERFORMANCE_FEATURE:"performance_feature",HEALTH_FEATURE:"health_feature",TRAINER_AND_CLUBS_FEATURE:"trainer_and_clubs_feature",GYMS_FEATURE:"gyms_feature",EQUIPMENT_FEATURE:"equipment_feature",SUGGESTIONS_FEATURE:"suggestions_feature",ACCOUNT_SETTINGS_FEATURE:"account_settings_feature",APP_SETTINGS_FEATURE:"app_settings_feature",HELP_SUPPORT_FEATURE:"help_support_feature",DASHBOARD_FEATURE:"dashboard_feature"}},55414:(e,t,r)=>{r.r(t),r.d(t,{FeatureFlagProvider:()=>h,useFeatureFlags:()=>g});var a=r(20906),s=r(33826),i=r(24830);class n{async get(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.DEFAULT_TTL;if(!i.n0.caching.enabled)return await t();let a=this.cache.get(e);if(a&&Date.now()-a.timestamp<a.ttl)return a.data;let s=await t();return this.cache.set(e,{data:s,timestamp:Date.now(),ttl:r}),s}invalidate(e){for(let t of this.cache.keys())t.includes(e)&&this.cache.delete(t)}invalidateUser(e){this.invalidate("user-".concat(e))}invalidateFeatureFlag(e){this.invalidate("feature-".concat(e))}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}constructor(){this.cache=new Map,this.DEFAULT_TTL=i.n0.caching.ttl}}let u=new n;class o{trackFeatureFlagUsage(e,t,r){this.metrics.usage[e]=(this.metrics.usage[e]||0)+1}trackFeatureFlagError(e,t,r){console.error("[Feature Flag Error]",e,t,r),this.metrics.errors[e]=(this.metrics.errors[e]||0)+1}trackFeatureFlagPerformance(e,t,r){this.metrics.performance[e]=t}trackCacheHit(e){this.metrics.cache.hits++}trackCacheMiss(e){this.metrics.cache.misses++}trackUserTypeAssignment(e,t){console.log("[User Type Assignment]",e,t),this.metrics.userAssignments.types[t]=(this.metrics.userAssignments.types[t]||0)+1}trackUserGroupAssignment(e,t){console.log("[User Group Assignment]",e,t),this.metrics.userAssignments.groups[t]=(this.metrics.userAssignments.groups[t]||0)+1}getMetrics(){return{...this.metrics}}resetMetrics(){this.metrics={usage:{},errors:{},performance:{},cache:{hits:0,misses:0},userAssignments:{types:{},groups:{}}}}constructor(){this.metrics={usage:{},errors:{},performance:{},cache:{hits:0,misses:0},userAssignments:{types:{},groups:{}}}}}let l=new o;var c=r(96196);let d=(0,s.createContext)(void 0),h=e=>{let{children:t}=e,{user:r}=(0,c.A)(),[i,n]=(0,s.useState)({}),[o,h]=(0,s.useState)({}),[g,f]=(0,s.useState)([]),[p,m]=(0,s.useState)([]),[v,E]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/feature-flags/public");if(e.ok){let{flags:t}=await e.json(),r=t.reduce((e,t)=>(e[t.name]={name:t.name,isEnabled:t.is_enabled,rolloutPercentage:t.rollout_percentage},e),{});n(r)}}catch(e){}})()},[]);let _=(0,s.useCallback)(async()=>{if(!r||!r.id){h({}),f([]),m([]),E(!1);return}E(!0),f((r.userRoles||[]).map(e=>({typeName:e,displayName:e,description:""}))),m((r.userGroups||[]).map(e=>({groupName:e,displayName:e,description:""})));let e=Date.now();try{let t=await fetch("/api/feature-flags");if(!t.ok)throw Error("Failed to fetch user feature flags");let{flags:a}=await t.json(),s=a.reduce((e,t)=>(e[t.name]={name:t.name,isEnabled:t.is_enabled,rolloutPercentage:t.rollout_percentage},e),{});h(s);let i=Date.now()-e;l.trackFeatureFlagPerformance("feature_flags_load",i,r.id)}catch(e){l.trackFeatureFlagError("feature_flags_load",e,r.id)}finally{E(!1)}},[r]);(0,s.useEffect)(()=>{_()},[_]);let y=(0,s.useMemo)(()=>({...i,...o}),[i,o]),A=(0,s.useCallback)(e=>{let t=y[e],a=!!t&&t.isEnabled;return r&&l.trackFeatureFlagUsage(e,a,r.id),a},[y,r]),b=(0,s.useCallback)(e=>g.some(t=>t.typeName===e),[g]),F=(0,s.useCallback)(e=>p.some(t=>t.groupName===e),[p]),T=(0,s.useCallback)(async()=>{r&&(u.invalidateUser(r.id),await _())},[r,_]);return(0,a.jsx)(d.Provider,{value:{flags:y,userTypes:g,userGroups:p,isLoading:v,isEnabled:A,hasUserType:b,isInGroup:F,refreshFlags:T},children:t})},g=()=>{let e=(0,s.useContext)(d);if(!e)throw Error("useFeatureFlags must be used within FeatureFlagProvider");return e}},62532:(e,t,r)=>{r.d(t,{$v:()=>a.$v,u:()=>i});var a=r(24830),s=r(55414);function i(e){let{isEnabled:t,isLoading:r,flags:a}=(0,s.useFeatureFlags)(),i=()=>e.reduce((e,t)=>(e[t]=!1,e),{});return r?{flags:i(),isLoading:!0}:0===Object.keys(a).length?{flags:i(),isLoading:!1}:{flags:e.reduce((e,r)=>(e[r]=t(r),e),{}),isLoading:r}}},66208:(e,t,r)=>{r.d(t,{cn:()=>i});var a=r(63756),s=r(77564);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},96196:(e,t,r)=>{r.d(t,{AuthProvider:()=>c,A:()=>d});var a=r(20906),s=r(12488),i=r(33826),n=r(49005),u=r(91670);let o=(0,i.createContext)(void 0),l=async e=>{let t=await fetch(e);if(!t.ok){if(401===t.status)return null;let e=Error("An error occurred while fetching the user.");throw e.info=await t.json(),e.status=t.status,e}return(await t.json()).user||null},c=e=>{let{children:t}=e,r=(0,u.createBrowserClient)("http://127.0.0.1:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"),c=(0,s.useRouter)(),[d,h]=(0,i.useState)(!1),{data:g,mutate:f}=(0,n.Ay)("/api/auth/user",l,{revalidateOnFocus:!0,shouldRetryOnError:!1,suspense:!0,fallbackData:null}),p=(0,i.useCallback)(async(e,t)=>{"SIGNED_IN"===e||"USER_UPDATED"===e?await f():"SIGNED_OUT"===e&&await f(null,!1)},[f]);(0,i.useEffect)(()=>{let{data:{subscription:e}}=r.auth.onAuthStateChange((e,t)=>{p(e,t)});return()=>{e.unsubscribe()}},[r,p]);let m=async(e,t)=>{if(e&&t){h(!0);try{let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await r.json();if(!r.ok)throw Error(a.error||"Login failed");await f(a.user,!1),c.push("/dashboard")}finally{h(!1)}}},v=async(e,t,r)=>{if(e&&t&&r){h(!0);try{let a=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:r})}),s=await a.json();if(!a.ok)throw Error(s.error||"Sign up failed");await f(s.user,!1),c.push("/dashboard")}finally{h(!1)}}},E=async()=>{h(!0);try{let e=await fetch("/api/auth/logout",{method:"POST"});if(!e.ok){let t=await e.json();throw Error(t.error||"Logout failed")}await f(null,!1),c.push("/")}finally{h(!1)}};return(0,a.jsx)(o.Provider,{value:{isAuthenticated:!!g,isAuthOperationLoading:d,login:m,logout:E,signUp:v,user:g||null,userId:(null==g?void 0:g.id)||null,userRoles:(null==g?void 0:g.userRoles)||[],userGroups:(null==g?void 0:g.userGroups)||[],hasRole:e=>{var t;return(null==g||null==(t=g.userRoles)?void 0:t.includes(e))||!1},hasGroup:e=>{var t;return(null==g||null==(t=g.userGroups)?void 0:t.includes(e))||!1},hasAnyRole:e=>(null==e?void 0:e.some(e=>{var t;return null==g||null==(t=g.userRoles)?void 0:t.includes(e)}))||!1,hasAnyGroup:e=>(null==e?void 0:e.some(e=>{var t;return null==g||null==(t=g.userGroups)?void 0:t.includes(e)}))||!1},children:t})},d=()=>{let e=(0,i.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);