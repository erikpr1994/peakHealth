name: Deploy Web App

on:
  push:
    branches: [main]
    paths:
      - 'apps/web/**'
      - 'packages/**'
      - 'package.json'
      - 'pnpm-lock.yaml'
      - 'turbo.json'
      - '.github/workflows/deploy-web.yml'
  # Allow manual triggering
  workflow_dispatch:

# Cancel in-progress runs on new pushes
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  deploy-web:
    name: Deploy Web App
    uses: ./.github/workflows/reusable-deploy.yml
    with:
      app-name: web
      project-id-secret: VERCEL_PROJECT_ID_WEB
      sentry-project-secret: SENTRY_PROJECT_WEB
      working-directory: ./apps/web
      filter-paths: |
        apps/web/**
        packages/**
        package.json
        pnpm-lock.yaml
        turbo.json
        .github/workflows/deploy-web.yml
    secrets:
      VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
      VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
      SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
      SENTRY_ORG: ${{ secrets.SENTRY_ORG }}
